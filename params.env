export DEPLOYMENT_TARGET=${DEPLOYMENT_TARGET:='dev'}
export GIT_COMMIT=${GIT_COMMIT:=$(git log --format="%H" -n1 | head -c 7)}
export GIT_BRANCH=${GIT_BRANCH:=$(git branch --show-current)}
export AWS_DEFAULT_REGION=us-east-1
export AWS_PROFILE=${AWS_PROFILE:='sa-dev'}
export AWS_ACCOUNT=$(aws sts get-caller-identity --query 'Account')
export APP_VERSION=$(echo "console.log(require('./package.json').version)" | node)
export APP_NAME="SA.Core.Infra"
export APP_DESCRIPTION="Baseline infrastructure for SA shared use."
export ORG_NAME="Sentiment Analytics"
export ORG_NAME_ABBV="SA"
export BUSINESS_UNIT="Platform Technology"
export PROJECT_NAME="SA Platform"
export TECHNICAL_CONTACT=wes.reid@sentiment.trading
export FQDN=sentiment.trading
# export NODE_TLS_REJECT_UNAUTHORIZED=0


# Parameters
export EXISTING_HOSTED_ZONE_ID=$(aws ssm get-parameter --name "hostedzone-main-id-sa-dev" --query "Parameter.Value" --output text)
export EXISTING_HOSTED_ZONE_NAME=$(aws ssm get-parameter --name "hostedzone-main-name-sa-dev" --query "Parameter.Value" --output text)
export SA_WILDCARD_CERT_ARN=$(aws ssm get-parameter --name "wildcard-cert-arn-sa-dev" --query "Parameter.Value" --output text)
export TGSR_DDB_SPOT_PRICES_TABLE_ARN=$(aws ssm get-parameter --name "/tgsr/prod/ddb-spot-prices-table-arn" --query "Parameter.Value" --output text)
export MT4_SQLSVR_CONNECTION_JSON=$(aws secretsmanager get-secret-value --secret-id "sa/dev/mt4-db-creds" --query "SecretString" --output text)
export MT4_SQLSVR_CONNECTION_STRING=$(echo "const data = $MT4_SQLSVR_CONNECTION_JSON; console.log(data.connectionString)" | node)

echo $MT4_SQLSVR_CONNECTION_STRING
# echo "TGSR_DDB_SPOT_PRICES_TABLE_ARN: $TGSR_DDB_SPOT_PRICES_TABLE_ARN"

# Target AWS Account
# This will override the account to deploy to on any standard branch build default targets (i.e. dev, stage, uat, master)
# export AWS_DEPLOY_ACCOUNT_OVERRIDE=some-specific-aws-account

# Build from feature branch
export FEATURE_BRANCH_BUILD_PATTERN="^JIRA-[0-9]{3,4}.*"
export FEATURE_BRANCH_BUILD_AWS_DEPLOY_ACCOUNT=specific-aws-account-to-deploy-feature-branch
